<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini App Test</title>
    <script src="telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            padding: 20px;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--tg-theme-text-color, #000000);
        }

        .section {
            margin-bottom: 30px;
        }

        .section h2 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--tg-theme-hint-color, #666666);
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            background-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            font-size: 14px;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        button:hover {
            opacity: 0.8;
        }

        button:active {
            opacity: 0.6;
        }

        #logSection {
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 8px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 8px;
            margin-bottom: 5px;
            background-color: var(--tg-theme-bg-color, #ffffff);
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            word-wrap: break-word;
        }

        .log-entry.info {
            border-left: 3px solid #3390ec;
        }

        .log-entry.error {
            border-left: 3px solid #e74c3c;
            color: #e74c3c;
        }

        .log-entry.success {
            border-left: 3px solid #2ecc71;
        }

        .clear-btn {
            margin-top: 10px;
            background-color: var(--tg-theme-destructive-text-color, #e74c3c);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mini App Test Interface</h1>

        <div class="section">
            <h2>Basic Tests</h2>
            <div class="button-grid">
                <button onclick="testReady()">Ready</button>
                <button onclick="testExpand()">Expand</button>
                <button onclick="testClose()">Close</button>
                <button onclick="testHaptic()">Haptic Feedback</button>
            </div>
        </div>

        <div class="section">
            <h2>User Info</h2>
            <div class="button-grid">
                <button onclick="getUserData()">Get User Data</button>
                <button onclick="getInitData()">Get Init Data</button>
                <button onclick="getThemeParams()">Get Theme</button>
                <button onclick="getViewport()">Get Viewport</button>
            </div>
        </div>

        <div class="section">
            <h2>Interactions</h2>
            <div class="button-grid">
                <button onclick="showAlert()">Show Alert</button>
                <button onclick="showConfirm()">Show Confirm</button>
                <button onclick="showPopup()">Show Popup</button>
                <button onclick="openLink()">Open Link</button>
            </div>
        </div>

        <div class="section">
            <h2>Main Button</h2>
            <div class="button-grid">
                <button onclick="showMainButton()">Show Main Button</button>
                <button onclick="hideMainButton()">Hide Main Button</button>
                <button onclick="setMainButtonText()">Change Text</button>
            </div>
        </div>

        <div class="section">
            <h2>Log Console</h2>
            <div id="logSection"></div>
            <button class="clear-btn" onclick="clearLogs()">Clear Logs</button>
        </div>
    </div>

    <script>
        // Override console.log to also display in the log section
        const originalLog = console.log;
        const originalError = console.error;

        function addLog(message, type = 'info') {
            const logSection = document.getElementById('logSection');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;

            const timestamp = new Date().toLocaleTimeString();
            const messageStr = typeof message === 'object' ? JSON.stringify(message, null, 2) : String(message);

            entry.textContent = `[${timestamp}] ${messageStr}`;
            logSection.appendChild(entry);
            logSection.scrollTop = logSection.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'info');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };

        // Initialize Telegram WebApp
        const tg = window.Telegram.WebApp;

        function testReady() {
            console.log('Calling ready()...');
            tg.ready();
            addLog('WebApp ready() called', 'success');
        }

        function testExpand() {
            console.log('Expanding WebApp...');
            tg.expand();
            addLog('WebApp expanded', 'success');
        }

        function testClose() {
            console.log('Closing WebApp...');
            tg.close();
        }

        function testHaptic() {
            console.log('Triggering haptic feedback...');
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('medium');
                addLog('Haptic feedback triggered', 'success');
            } else {
                addLog('Haptic feedback not available', 'error');
            }
        }

        function getUserData() {
            console.log('User data:', tg.initDataUnsafe.user);
            addLog('User: ' + JSON.stringify(tg.initDataUnsafe.user || 'No user data'), 'info');
        }

        function getInitData() {
            console.log('Init data:', tg.initData);
            addLog('Init data: ' + (tg.initData || 'Empty'), 'info');
        }

        function getThemeParams() {
            console.log('Theme params:', tg.themeParams);
            addLog('Theme: ' + JSON.stringify(tg.themeParams), 'info');
        }

        function getViewport() {
            const viewport = {
                height: tg.viewportHeight,
                stableHeight: tg.viewportStableHeight,
                isExpanded: tg.isExpanded
            };
            console.log('Viewport:', viewport);
            addLog('Viewport: ' + JSON.stringify(viewport), 'info');
        }

        function showAlert() {
            console.log('Showing alert...');
            tg.showAlert('This is a test alert!', () => {
                addLog('Alert closed', 'success');
            });
        }

        function showConfirm() {
            console.log('Showing confirm...');
            tg.showConfirm('Do you want to continue?', (confirmed) => {
                addLog('Confirm result: ' + confirmed, 'success');
            });
        }

        function showPopup() {
            console.log('Showing popup...');
            tg.showPopup({
                title: 'Test Popup',
                message: 'This is a test popup message',
                buttons: [
                    {id: 'ok', type: 'ok'},
                    {id: 'cancel', type: 'cancel'}
                ]
            }, (buttonId) => {
                addLog('Popup button clicked: ' + buttonId, 'success');
            });
        }

        function openLink() {
            console.log('Opening link...');
            tg.openLink('https://telegram.org');
            addLog('Link opened', 'success');
        }

        function showMainButton() {
            console.log('Showing main button...');
            tg.MainButton.setText('Main Button');
            tg.MainButton.show();
            tg.MainButton.onClick(() => {
                addLog('Main button clicked!', 'success');
            });
            addLog('Main button shown', 'success');
        }

        function hideMainButton() {
            console.log('Hiding main button...');
            tg.MainButton.hide();
            addLog('Main button hidden', 'success');
        }

        function setMainButtonText() {
            console.log('Changing main button text...');
            tg.MainButton.setText('Custom Text ' + Date.now());
            addLog('Main button text changed', 'success');
        }

        function clearLogs() {
            document.getElementById('logSection').innerHTML = '';
            originalLog('Logs cleared');
        }

        // Initialize
        console.log('Mini App Test Interface loaded');
        console.log('Telegram WebApp version:', tg.version);
        console.log('Platform:', tg.platform);
    </script>
</body>
</html>
